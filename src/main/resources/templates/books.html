<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Libri</title>
    <link rel="stylesheet" href="/css/base.css" />
    <link rel="stylesheet" href="/css/book.css" />
    <link rel="stylesheet" href="/css/review.css" />
  </head>

  <body>
    <div th:replace="fragments/navbar :: navbar"></div>

    <h1>Libri</h1>

    <!-- Form di ricerca per titolo e anno -->
    <form method="get" th:action="@{/books/search}" class="search-form">
      <input
        type="text"
        name="q"
        placeholder="Titolo‚Ä¶"
        th:value="${q}"
      />
      <input
        type="number"
        name="anno"
        min="0"
        max="2025"
        placeholder="Anno‚Ä¶"
        th:value="${anno}"
      />
      <button type="submit">üîç Cerca</button>
    </form>

    <!-- Pulsante Annulla ricerca -->
    <div th:if="${q != null or anno != null}" class="cancel-search">
      <a th:href="@{/books}" class="button">Annulla ricerca</a>
    </div>

    <!-- Conteggio risultati -->
    <div th:if="${count != null}">
      <p>Risultati trovati: <strong th:text="${count}"></strong></p>
    </div>

    <!-- Messaggio di nessun risultato -->
    <div th:if="${message != null}" class="info" th:text="${message}"></div>

    <!-- Lista dei libri come card -->
    <section class="books">
      <div class="book-card" th:each="book : ${books}">
        <a th:href="@{'/book/' + ${book.id}}">
          <!-- Copertina se disponibile -->
          <img th:if="${book.immagini != null and !book.immagini.isEmpty()}"
               th:src="@{'/uploads/' + ${book.immagini[0].path}}"
               alt="Copertina di [[${book.titolo}]]">
          <!-- Placeholder -->
          <img th:if="${book.immagini == null or book.immagini.isEmpty()}"
               src="/images/default_book.jpg"
               alt="Nessuna immagine disponibile">
          <div class="title-overlay">
            <h2 th:text="${book.titolo} + ' (' + ${book.annoPubblicazione} + ')'">
              Titolo del libro
            </h2>
             <a th:href="@{'/logged/formNewReview/' + ${book.id}}"
              class="review-button">
              Lascia una recensione
            </a>
          </div>
        </a>
      </div>
    </section>
  </body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="'Modifica Libro â€“ ' + ${book.titolo}">Modifica Libro</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
</head>
<body>
  <div class="container mt-4">
    <a th:href="@{/}"><img th:src="@{/images/logo.png}" width="20%" alt="Logo"></a>
    <h2 class="mt-3">Modifica Libro</h2>

    <form th:action="@{/admin/book/{id}(id=${book.id})}"
          th:object="${book}"
          method="post"
          enctype="multipart/form-data">
      <!-- override HTTP method per PUT -->
      <input type="hidden" name="_method" value="put"/>
      <!-- CSRF token, se necessario -->
      <input type="hidden" th:name="${_csrf.parameterName}"
             th:value="${_csrf.token}" />

      <!-- error globali -->
      <p th:each="err : ${#fields.globalErrors()}"
         th:text="${err}" class="text-danger"></p>

      <div class="mb-3">
        <label class="form-label">Titolo:</label>
        <input required type="text" th:field="*{titolo}" class="form-control"/>
        <div th:if="${#fields.hasErrors('titolo')}"
             th:errors="*{titolo}" class="text-danger"></div>
      </div>

      <div class="mb-3">
        <label class="form-label">Anno pubblicazione:</label>
        <input required type="text" th:field="*{annoPubblicazione}" class="form-control"/>
        <div th:if="${#fields.hasErrors('annoPubblicazione')}"
             th:errors="*{annoPubblicazione}" class="text-danger"></div>
      </div>

      <!-- Preview delle immagini correnti -->
      <div class="mb-3" th:if="${book.immagini}">
        <label class="form-label">Immagini correnti:</label>
        <div class="row">
          <div class="col-md-3 mb-2" th:each="img : ${book.immagini}">
            <img th:src="@{/uploads/{f}(f=${img.path})}"
                 class="img-fluid rounded" alt="Immagine libro"/>
          </div>
        </div>
      </div>

      <!-- Sostituisci con nuove immagini -->
      <div class="mb-3">
        <label class="form-label">Carica nuove immagini (sostituiranno quelle esistenti):</label>
        <input type="file" name="bookImages" accept="image/*" multiple class="form-control">
      </div>

      <div class="mb-3">
        <label class="form-label">Autori:</label>
        <input type="text"
               class="form-control mb-2 list-filter"
               placeholder="Cerca un autore..."
               data-target="authors"/>
        <select multiple
                id="authors"
                class="form-select"
                size="6"
                th:field="*{authors}">
          <option th:each="aut : ${allAuthors}"
                  th:value="${aut.id}"
                  th:text="${aut.name + ' ' + aut.surname}">
          </option>
        </select>
        <div class="form-text">Ctrl/Cmd + click per selezione multipla.</div>
      </div>

      <button type="submit" class="btn btn-success">
        <i class="bi bi-save"></i> Salva modifiche
      </button>
      <a th:href="@{/book/{id}(id=${book.id})}" class="btn btn-secondary">
        Annulla
      </a>
    </form>
  </div>

  <script th:src="@{/js/filterList.js}"></script>
</body>
</html>

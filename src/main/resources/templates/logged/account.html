<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Profilo Utente</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div th:replace="fragments/flash :: flash-messages"></div>
  <div class="container my-5">
    <div class="card shadow-lg rounded-4">
      <div class="row g-0">
        <!-- Immagine profilo -->
            <div class="col-md-4 d-flex align-items-center justify-content-center p-3">
            <img th:src="${user.image != null} 
                        ? @{/uploads/{file}(file=${user.image.path})} 
                        : @{/images/default-profile.png}"
                class="img-fluid img-thumbnail rounded-circle"
                alt="Foto profilo dellâ€™utente"/>
            </div>

        <!-- Dettagli utente -->
        <div class="col-md-8">
          <div class="card-body">
            <h3 class="card-title" th:text="${user.name + ' ' + user.surname}">
              Nome Cognome
            </h3>
            <p class="card-text">
              <strong>Email:</strong>
              <span th:text="${user.email}">email@example.com</span>
            </p>

            <!-- Data di nascita -->
            <p class="card-text" th:if="${user.birth != null}">
              <strong>Data di nascita:</strong>
              <span th:text="${#temporals.format(user.birth, 'dd/MM/yyyy')}">
                01/01/1990
              </span>
            </p>
            <p class="card-text" th:if="${user.birth == null}">
              <strong>Data di nascita:</strong>
              <span class="text-muted">N/A</span>
            </p>

            <!-- Sezione recensioni -->
            <div th:if="${user.recensioni != null and !user.recensioni.isEmpty()}">
              <h5 class="mt-4">Recensioni:</h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item"
                    th:each="rec : ${user.recensioni}"
                    th:text="${rec.titolo}">
                  Titolo recensione
                </li>
              </ul>
            </div>
            <div th:if="${user.recensioni == null or user.recensioni.isEmpty()}">
              <p class="text-muted mt-4">Nessuna recensione disponibile.</p>
            </div>

          </div>
        </div>

          <!-- pulsante Elimina Utente -->
        <div class="mt-4">
            <form th:action="@{/logged/account/deleteMe}" method="post" onsubmit="return confirm('Sei sicuro di voler eliminare questo utente e la sua immagine?');">
                <!-- CSRF token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <!-- override method -->
                <input type="hidden" name="_method" value="delete"/>
                <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Elimina Utente
                </button>
            </form>
        </div>

        <div class="mt-3 d-inline-block">
            <!-- Link per visualizzare il form di modifica -->
            <a th:href="@{/logged/account/edit}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Modifica profilo
            </a>
        </div>

      </div>
    </div>
  </div>
</body>
</html>
